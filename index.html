<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Costruisci il tuo mondo</title>

<style>
*{box-sizing:border-box;margin:0;padding:0;}

html,body{
  height:100%;
}

body{
  background:radial-gradient(circle at top,#87cefa,#14508a);
  font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
  color:#fff;
}

/* layout base */
#app{
  min-height:100vh;
  display:flex;
  flex-direction:column;
  align-items:center;
}

#titlebar{
  padding:10px;
  text-align:center;
  font-size:28px;
  font-weight:700;
}

#layout{
  flex:1;
  width:100%;
  max-width:1200px;
  display:flex;
  gap:8px;
  padding:8px;
}

/* mondo */
#world-wrapper{
  flex:2;
  display:flex;
  justify-content:center;
  align-items:center;
}

#world{
  width:100%;
  max-width:900px;
  height:65vh;
  max-height:600px;
  border-radius:20px;
  border:4px solid #000;
  background:linear-gradient(#87cefa 50%, #5baa3d 50%);
  position:relative;
  overflow:hidden;
}

/* oggetti nel mondo */
.world-object{
  position:absolute;
  width:80px;
  height:80px;
  border-radius:16px;
  border:3px solid #000;
  background:#fff8e8;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:40px;
  box-shadow:0 4px 0 #333;
  cursor:pointer;
  touch-action:none;
}

/* pannello laterale */
#sidebar{
  flex:1;
  border-radius:18px;
  border:4px solid #000;
  background:rgba(0,0,0,0.35);
  padding:8px;
  display:flex;
  flex-direction:column;
}

#sidebar h2{
  font-size:18px;
  text-align:center;
  margin-bottom:6px;
}

/* tab categorie */
.tabs{
  display:flex;
  flex-wrap:wrap;
  gap:4px;
  justify-content:center;
  margin-bottom:6px;
}

.tab-btn{
  padding:4px 7px;
  border-radius:14px;
  border:3px solid #000;
  background:#ffe49b;
  box-shadow:0 3px 0 #c28a00;
  font-size:12px;
  cursor:pointer;
}
.tab-btn.active{
  background:#ffb347;
}

/* lista oggetti */
#item-list{
  flex:1;
  border-radius:14px;
  border:3px solid #000;
  background:rgba(255,255,255,0.9);
  padding:6px;
  overflow-y:auto;
  color:#000;
}

.item-btn{
  width:100%;
  display:flex;
  align-items:center;
  padding:6px 4px;
  margin-bottom:4px;
  border-radius:12px;
  border:2px solid #000;
  background:#ffecc4;
  cursor:pointer;
}
.item-icon{
  width:40px;
  height:40px;
  border-radius:12px;
  border:2px solid #000;
  background:#fff;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:26px;
  margin-right:6px;
}
.item-label{
  font-size:14px;
  font-weight:600;
}

/* bottoni gestione */
#sidebar-actions{
  margin-top:6px;
  text-align:center;
}

.btn-small{
  padding:6px 10px;
  margin:2px;
  border-radius:12px;
  border:3px solid #000;
  background:#ffb3b3;
  box-shadow:0 3px 0 #a00000;
  font-size:13px;
  cursor:pointer;
}

/* info */
#hint{
  margin-top:4px;
  font-size:12px;
  line-height:1.3;
}

/* responsive mobile */
@media (max-width:768px){
  #layout{
    flex-direction:column;
  }
  #world{
    height:55vh;
  }
}
</style>
</head>
<body>
<div id="app">
  <div id="titlebar">üåç Costruisci il tuo mondo</div>

  <div id="layout">
    <div id="world-wrapper">
      <div id="world"></div>
    </div>

    <div id="sidebar">
      <h2>Pannello oggetti</h2>

      <div class="tabs">
        <button class="tab-btn active" data-cat="alberi">üå≤ Alberi</button>
        <button class="tab-btn" data-cat="fiori">üåº Fiori</button>
        <button class="tab-btn" data-cat="animali">üêæ Animali</button>
        <button class="tab-btn" data-cat="case">üè° Case</button>
        <button class="tab-btn" data-cat="recinti">üß± Terreno</button>
        <button class="tab-btn" data-cat="cielo">‚òÅÔ∏è Cielo</button>
        <button class="tab-btn" data-cat="extra">‚≠ê Extra</button>
        <button class="tab-btn" data-cat="veicoli">üöó Veicoli</button>
      </div>

      <div id="item-list"></div>

      <div id="sidebar-actions">
        <button class="btn-small" onclick="removeLast()">Rimuovi ultimo</button>
        <button class="btn-small" onclick="clearWorld()">Svuota tutto</button>
      </div>

      <div id="hint">
        ‚û§ Tocca un oggetto nella lista per aggiungerlo nel mondo.<br>
        ‚û§ Poi trascinalo con il dito o con il mouse.
      </div>
    </div>
  </div>
</div>

<script>
// ====== DATI OGGETTI (emoji, pronti per PNG in futuro) ======
const ITEMS = {
  alberi: [
    { name:"Abete", emoji:"üå≤" },
    { name:"Albero tondo", emoji:"üå≥" },
    { name:"Albero di Natale", emoji:"üéÑ" },
    { name:"Palma", emoji:"üå¥" },
    { name:"Cactus", emoji:"üåµ" },
    { name:"Albero autunno", emoji:"üçÅ" },
    { name:"Foglie cadute", emoji:"üçÇ" },
    { name:"Fungo bosco", emoji:"üçÑ" },
    { name:"Ramo secco", emoji:"ü™µ" },
    { name:"Boschetto", emoji:"üå≤" }
  ],
  fiori: [
    { name:"Fiore rosso", emoji:"üåπ" },
    { name:"Fiore giallo", emoji:"üåª" },
    { name:"Fiore bianco", emoji:"üåº" },
    { name:"Fiore rosa", emoji:"üå∏" },
    { name:"Bouquet", emoji:"üíê" },
    { name:"Fiori tropicali", emoji:"üå∫" },
    { name:"Tulipano", emoji:"üå∑" },
    { name:"Spiga", emoji:"üåæ" },
    { name:"Cespuglio verde", emoji:"üåø" },
    { name:"Cespuglio fiorito", emoji:"üå∫" }
  ],
  animali: [
    { name:"Coniglio", emoji:"üê∞" },
    { name:"Cane", emoji:"üê∂" },
    { name:"Gatto", emoji:"üê±" },
    { name:"Topo", emoji:"üê≠" },
    { name:"Orsetto", emoji:"üêª" },
    { name:"Panda", emoji:"üêº" },
    { name:"Maialino", emoji:"üê∑" },
    { name:"Mucca", emoji:"üêÆ" },
    { name:"Rana", emoji:"üê∏" },
    { name:"Scimmietta", emoji:"üêµ" },
    { name:"Pulcino", emoji:"üê•" },
    { name:"Pinguino", emoji:"üêß" }
  ],
  case: [
    { name:"Casa", emoji:"üè†" },
    { name:"Villetta", emoji:"üè°" },
    { name:"Gruppo di case", emoji:"üèòÔ∏è" },
    { name:"Casetta vecchia", emoji:"üèöÔ∏è" },
    { name:"Tenda", emoji:"‚õ∫" },
    { name:"Campo con tende", emoji:"üèïÔ∏è" },
    { name:"Scuola", emoji:"üè´" },
    { name:"Fabbrica", emoji:"üè≠" },
    { name:"Castello", emoji:"üè∞" }
  ],
  recinti: [
    { name:"Recinto lavori", emoji:"üöß" },
    { name:"Muro mattoni", emoji:"üß±" },
    { name:"Roccia grande", emoji:"ü™®" },
    { name:"Ceppo di legno", emoji:"ü™µ" },
    { name:"Pozzo / lago", emoji:"üíß" },
    { name:"Albero tagliato", emoji:"ü™ì" },
    { name:"Cartello attenzione", emoji:"‚ö†Ô∏è" },
    { name:"Cartello stop", emoji:"üõë" },
    { name:"Cancello", emoji:"üö™" }
  ],
  cielo: [
    { name:"Sole", emoji:"‚òÄÔ∏è" },
    { name:"Sole tra nuvole", emoji:"üå§Ô∏è" },
    { name:"Sole al tramonto", emoji:"üåá" },
    { name:"Nuvola", emoji:"‚òÅÔ∏è" },
    { name:"Nuvola e sole", emoji:"‚õÖ" },
    { name:"Nuvola carica", emoji:"üå•Ô∏è" },
    { name:"Pioggia", emoji:"üåßÔ∏è" },
    { name:"Temporale", emoji:"‚õàÔ∏è" },
    { name:"Arcobaleno", emoji:"üåà" },
    { name:"Luna", emoji:"üåô" },
    { name:"Luna piena", emoji:"üåï" },
    { name:"Stella", emoji:"‚≠ê" },
    { name:"Stelle cadenti", emoji:"üå†" }
  ],
  extra: [
    { name:"Neve", emoji:"‚ùÑÔ∏è" },
    { name:"Neve che cade", emoji:"üå®Ô∏è" },
    { name:"Pupazzo di neve", emoji:"‚õÑ" },
    { name:"Regalo", emoji:"üéÅ" },
    { name:"Palloncino", emoji:"üéà" },
    { name:"Fuochi d'artificio", emoji:"üéÜ" },
    { name:"Fuochi colorati", emoji:"üéá" },
    { name:"Cuore rosso", emoji:"‚ù§Ô∏è" },
    { name:"Cuore scintillante", emoji:"üíñ" },
    { name:"Orsetto peluche", emoji:"üß∏" },
    { name:"Palla da calcio", emoji:"‚öΩ" }
  ],
  veicoli: [
    { name:"Auto", emoji:"üöó" },
    { name:"SUV", emoji:"üöô" },
    { name:"Autobus", emoji:"üöå" },
    { name:"Camion", emoji:"üöö" },
    { name:"Trattore", emoji:"üöú" },
    { name:"Camion dei pompieri", emoji:"üöí" },
    { name:"Ambulanza", emoji:"üöë" },
    { name:"Treno", emoji:"üöÜ" },
    { name:"Aereo", emoji:"‚úàÔ∏è" },
    { name:"Nave", emoji:"üö¢" },
    { name:"Barca a vela", emoji:"‚õµ" }
  ]
};

const world = document.getElementById("world");
const itemList = document.getElementById("item-list");
const tabButtons = document.querySelectorAll(".tab-btn");
let lastObject = null;

// ====== COSTRUISCI LISTA OGGETTI ======
function setCategory(cat){
  tabButtons.forEach(btn=>{
    btn.classList.toggle("active", btn.dataset.cat === cat);
  });

  itemList.innerHTML = "";
  const arr = ITEMS[cat] || [];
  arr.forEach(obj=>{
    const row = document.createElement("div");
    row.className = "item-btn";
    row.onclick = () => addObject(obj);

    const icon = document.createElement("div");
    icon.className = "item-icon";
    icon.textContent = obj.emoji;

    const label = document.createElement("div");
    label.className = "item-label";
    label.textContent = obj.name;

    row.appendChild(icon);
    row.appendChild(label);
    itemList.appendChild(row);
  });
}

tabButtons.forEach(btn=>{
  btn.addEventListener("click", ()=> setCategory(btn.dataset.cat));
});

// prima categoria
setCategory("alberi");

// ====== AGGIUNGI OGGETTO NEL MONDO ======
function addObject(obj){
  const el = document.createElement("div");
  el.className = "world-object";

  // per ora emoji; in futuro qui puoi mettere <img src="img/..." >
  el.textContent = obj.emoji;

  const wRect = world.getBoundingClientRect();
  const startX = wRect.width/2 - 40;
  const startY = wRect.height/2;
  el.style.left = startX + "px";
  el.style.top  = startY + "px";

  world.appendChild(el);
  makeDraggable(el, world);
  lastObject = el;
}

// ====== RIMUOVI ULTIMO / SVUOTA ======
function removeLast(){
  if(lastObject && lastObject.parentNode === world){
    world.removeChild(lastObject);
    lastObject = null;
  }else{
    const objs = world.querySelectorAll(".world-object");
    if(objs.length>0){
      const el = objs[objs.length-1];
      world.removeChild(el);
    }
  }
}

function clearWorld(){
  const objs = world.querySelectorAll(".world-object");
  objs.forEach(el=> el.remove());
  lastObject = null;
}

// ====== DRAG (mouse + touch) ======
function makeDraggable(el, container){
  let dragging = false;
  let offsetX = 0, offsetY = 0;

  function getPos(event){
    if(event.touches && event.touches[0]){
      return { x:event.touches[0].clientX, y:event.touches[0].clientY };
    }
    return { x:event.clientX, y:event.clientY };
  }

  function onMove(e){
    if(!dragging) return;
    const pos = getPos(e);
    const rect = container.getBoundingClientRect();
    let x = pos.x - rect.left - offsetX;
    let y = pos.y - rect.top  - offsetY;

    const maxX = rect.width - el.offsetWidth;
    const maxY = rect.height - el.offsetHeight;
    if(x < -20) x = -20;
    if(y < -20) y = -20;
    if(x > maxX+20) x = maxX+20;
    if(y > maxY+20) y = maxY+20;

    el.style.left = x + "px";
    el.style.top  = y + "px";

    if(e.cancelable) e.preventDefault();
  }

  function onUp(){
    dragging = false;
    document.removeEventListener("mousemove", onMove);
    document.removeEventListener("mouseup", onUp);
    document.removeEventListener("touchmove", onMove);
    document.removeEventListener("touchend", onUp);
  }

  function onDown(e){
    const pos = getPos(e);
    const rect = container.getBoundingClientRect();
    const currentLeft = parseInt(el.style.left || "0",10);
    const currentTop  = parseInt(el.style.top  || "0",10);

    offsetX = pos.x - rect.left - currentLeft;
    offsetY = pos.y - rect.top  - currentTop;

    dragging = true;

    document.addEventListener("mousemove", onMove, {passive:false});
    document.addEventListener("mouseup", onUp);
    document.addEventListener("touchmove", onMove, {passive:false});
    document.addEventListener("touchend", onUp);

    if(e.cancelable) e.preventDefault();
  }

  el.addEventListener("mousedown", onDown);
  el.addEventListener("touchstart", onDown, {passive:false});
}
</script>
</body>
</html>
